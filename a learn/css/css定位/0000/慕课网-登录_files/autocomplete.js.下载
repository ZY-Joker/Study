define(function(){$.fn.autocomplete=function(){$(".autoul")&&$(".autoul").remove(),a(this)};var a=function(a){for(var h=new Array("qq.com","163.com","126.com","gmail.com","sina.com","aliyun.com","hotmail.com","sohu.com","vip.126.com","vip.163.com","vip.qq.com","vip.sina.com","sina.cn","vip.163.com","msn.com","outlook.com","live.com","live.cn","yahoo.com.cn","yahoo.cn","yahoo.com.tw","21cn.com","tom.com"),v=[],i=0,c=h.length;c>i;i++)v.push({ext:h[i],index:i});for(var C=$("<ul class='autoul'></ul>"),i=0,y=v.length;y>i;i++){var k=$("<li data-key="+v[i].index+' class="autoli"><span class="ex"></span><span class="at">@</span><span class="step">'+v[i].ext+"</span></li>");k.appendTo($(C))}$(C).insertAfter(a),$(C).hide(),$(a).off("keyup.auto").on("keyup.auto",function(h){if(38!=h.keyCode&&40!=h.keyCode&&13!=h.keyCode){if(null==$.trim(this.value).match(/[^@]@/)){if(null==$.trim(this.value).match(/^@/))return void $(C).hide(0)}else{var v=$.trim($(this).val()),c=v.split("@");$(".ex").text(c[0]);var y=c[0].length;if(v.length>y+1){var k=v.substr(y+1);if(null!=k.match(/[\\]/))return k.replace(/[\\]/,""),!1;$(C).children("li").each(function(){var a=$(this).find("span.step");null!=a.text().match(k)&&0==a.text().indexOf(k)?(a.parent().hasClass("showli")||a.parent().addClass("showli"),k.length>=a.text().length&&a.parent().removeClass("showli").removeClass("lihover")):a.parent().removeClass("showli")}),$(C).find("li.showli").eq(0).addClass("lihover")}else $(C).find("li").each(function(i){$(this).removeClass("lihover"),$(this).hasClass("showli")||$(this).addClass("showli"),0==i&&$(this).addClass("lihover")})}""!=$.trim($(this).val())&&null==$.trim(this.value).match(/^@/)?(0!==$(C).find(".showli").length?$(C).show(0):$(C).hide(0),$(C).find(".lihover").removeClass("lihover").eq(0).addClass("lihover")):($(C).hide(),$(C).find("li:eq(0)").removeClass("lihover"))}(8==h.keyCode||46==h.keyCode)&&($(this).next().children().removeClass("lihover"),$(this).next().children("li:visible:eq(0)").addClass("lihover")),38==h.keyCode&&$(this).val($(this).val()),13==h.keyCode&&($(C).children("li").is(".lihover")&&$(a).val($(C).find(".lihover").children(".ex").text()+"@"+$(C).find(".lihover").children(".step").text()),$(C).children().hide(),$(C).children().removeClass("lihover"),$(C).hide(),$(a).blur())}),$(a).keydown(function(a){if(40==a.keyCode){var h=$(C).find(".lihover");if($(C).children("li").is(".lihover")){if($(h).attr("data-key")==$(C).children("li").length-1)return!1;h.nextAll().hasClass("showli")?($(h).removeClass("lihover").nextAll(".showli:eq(0)").addClass("lihover"),3==$(h).index()&&$(C).append($(C).children("li").eq(0))):($(h).removeClass("lihover"),$(C).find("li.showli").eq(0).addClass("lihover"))}}if(38==a.keyCode){var h=$(C).find(".lihover");if($(C).children("li").is(".lihover")){if(0==$(h).attr("data-key"))return!1;0==$(h).index()?$(C).prepend($(C).children("li").eq($(C).find(".showli").length-1)):$(h).removeClass("lihover").prev(".showli:eq(0)").addClass("lihover")}}}),$("body").click(function(){$(C).hide()}),$(C).find("li").hover(function(){$(C).find("li").hasClass("lihover")&&$(C).find("li").removeClass("lihover"),$(this).addClass("lihover")}),$(C).find("li").click(function(){$(C).find("li").hasClass("lihover")&&$(C).find("li").removeClass("lihover"),$(this).addClass("lihover"),$(a).val($(C).find(".lihover").children(".ex").text()+"@"+$(C).find(".lihover").children(".step").text()),$(C).children().removeClass("lihover"),$(a).blur()})}});